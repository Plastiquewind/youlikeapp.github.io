{"version":3,"sources":["webpack:///hub.8570cccfc468cea9ae26.js","webpack:///./src/hub/hub.ts","webpack:///./src/hub/hub.ts?f4c8","webpack:///./~/cross-storage/lib/index.js","webpack:///./~/cross-storage/lib/client.js","webpack:///./~/cross-storage/lib/hub.js"],"names":["webpackJsonp","0","module","exports","__webpack_require__","Object","defineProperty","value","cross_storage_1","CrossStorageHub","init","origin","allow","233","CrossStorageClient","234","root","url","opts","this","_id","_generateUUID","_promise","promise","Promise","_frameId","frameId","_origin","_getOrigin","_requests","_connected","_closed","_count","_timeout","timeout","_listener","_installListener","frame","document","getElementById","_poll","_createFrame","_hub","contentWindow","frameStyle","display","position","top","left","uri","protocol","createElement","href","host","window","location","replace","c","r","Math","random","v","toString","prototype","onConnect","client","resolve","reject","Error","connect","setTimeout","push","err","clearTimeout","set","key","_request","get","args","Array","slice","call","arguments","keys","del","clear","getKeys","close","parentNode","removeChild","removeEventListener","detachEvent","message","i","error","response","data","indexOf","length","JSON","parse","e","id","result","addEventListener","attachEvent","interval","targetOrigin","setInterval","clearInterval","postMessage","hasOwnProperty","style","body","appendChild","src","method","params","req","originalToJSON","toJSON","stringify","235","permissions","available","localStorage","parent","_permissions","listener","request","split","_permitted","entry","match","_inArray","RegExp","test","_set","setItem","_get","storage","getItem","_del","removeItem","_clear","_getKeys","array","_now","Date","now","getTime"],"mappings":"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","file":"hub.8570cccfc468cea9ae26.js","sourcesContent":["webpackJsonp([1],{\n\n/***/ 0:\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\r\n\tObject.defineProperty(exports, \"__esModule\", { value: true });\r\n\tvar cross_storage_1 = __webpack_require__(233);\r\n\tcross_storage_1.CrossStorageHub.init([\r\n\t    {\r\n\t        origin: /.*/,\r\n\t        allow: [\"get\", \"set\"]\r\n\t    }\r\n\t]);\r\n\n\n/***/ },\n\n/***/ 233:\n/***/ function(module, exports, __webpack_require__) {\n\n\tmodule.exports = {\n\t  CrossStorageClient: __webpack_require__(234),\n\t  CrossStorageHub:    __webpack_require__(235)\n\t};\n\n\n/***/ },\n\n/***/ 234:\n/***/ function(module, exports, __webpack_require__) {\n\n\t;(function(root) {\n\t  /**\n\t   * Constructs a new cross storage client given the url to a hub. By default,\n\t   * an iframe is created within the document body that points to the url. It\n\t   * also accepts an options object, which may include a timeout, frameId, and\n\t   * promise. The timeout, in milliseconds, is applied to each request and\n\t   * defaults to 5000ms. The options object may also include a frameId,\n\t   * identifying an existing frame on which to install its listeners. If the\n\t   * promise key is supplied the constructor for a Promise, that Promise library\n\t   * will be used instead of the default window.Promise.\n\t   *\n\t   * @example\n\t   * var storage = new CrossStorageClient('https://store.example.com/hub.html');\n\t   *\n\t   * @example\n\t   * var storage = new CrossStorageClient('https://store.example.com/hub.html', {\n\t   *   timeout: 5000,\n\t   *   frameId: 'storageFrame'\n\t   * });\n\t   *\n\t   * @constructor\n\t   *\n\t   * @param {string} url    The url to a cross storage hub\n\t   * @param {object} [opts] An optional object containing additional options,\n\t   *                        including timeout, frameId, and promise\n\t   *\n\t   * @property {string}   _id        A UUID v4 id\n\t   * @property {function} _promise   The Promise object to use\n\t   * @property {string}   _frameId   The id of the iFrame pointing to the hub url\n\t   * @property {string}   _origin    The hub's origin\n\t   * @property {object}   _requests  Mapping of request ids to callbacks\n\t   * @property {bool}     _connected Whether or not it has connected\n\t   * @property {bool}     _closed    Whether or not the client has closed\n\t   * @property {int}      _count     Number of requests sent\n\t   * @property {function} _listener  The listener added to the window\n\t   * @property {Window}   _hub       The hub window\n\t   */\n\t  function CrossStorageClient(url, opts) {\n\t    opts = opts || {};\n\t\n\t    this._id        = CrossStorageClient._generateUUID();\n\t    this._promise   = opts.promise || Promise;\n\t    this._frameId   = opts.frameId || 'CrossStorageClient-' + this._id;\n\t    this._origin    = CrossStorageClient._getOrigin(url);\n\t    this._requests  = {};\n\t    this._connected = false;\n\t    this._closed    = false;\n\t    this._count     = 0;\n\t    this._timeout   = opts.timeout || 5000;\n\t    this._listener  = null;\n\t\n\t    this._installListener();\n\t\n\t    var frame;\n\t    if (opts.frameId) {\n\t      frame = document.getElementById(opts.frameId);\n\t    }\n\t\n\t    // If using a passed iframe, poll the hub for a ready message\n\t    if (frame) {\n\t      this._poll();\n\t    }\n\t\n\t    // Create the frame if not found or specified\n\t    frame = frame || this._createFrame(url);\n\t    this._hub = frame.contentWindow;\n\t  }\n\t\n\t  /**\n\t   * The styles to be applied to the generated iFrame. Defines a set of properties\n\t   * that hide the element by positioning it outside of the visible area, and\n\t   * by modifying its display.\n\t   *\n\t   * @member {Object}\n\t   */\n\t  CrossStorageClient.frameStyle = {\n\t    display:  'none',\n\t    position: 'absolute',\n\t    top:      '-999px',\n\t    left:     '-999px'\n\t  };\n\t\n\t  /**\n\t   * Returns the origin of an url, with cross browser support. Accommodates\n\t   * the lack of location.origin in IE, as well as the discrepancies in the\n\t   * inclusion of the port when using the default port for a protocol, e.g.\n\t   * 443 over https. Defaults to the origin of window.location if passed a\n\t   * relative path.\n\t   *\n\t   * @param   {string} url The url to a cross storage hub\n\t   * @returns {string} The origin of the url\n\t   */\n\t  CrossStorageClient._getOrigin = function(url) {\n\t    var uri, protocol, origin;\n\t\n\t    uri = document.createElement('a');\n\t    uri.href = url;\n\t\n\t    if (!uri.host) {\n\t      uri = window.location;\n\t    }\n\t\n\t    if (!uri.protocol || uri.protocol === ':') {\n\t      protocol = window.location.protocol;\n\t    } else {\n\t      protocol = uri.protocol;\n\t    }\n\t\n\t    origin = protocol + '//' + uri.host;\n\t    origin = origin.replace(/:80$|:443$/, '');\n\t\n\t    return origin;\n\t  };\n\t\n\t  /**\n\t   * UUID v4 generation, taken from: http://stackoverflow.com/questions/\n\t   * 105034/how-to-create-a-guid-uuid-in-javascript/2117523#2117523\n\t   *\n\t   * @returns {string} A UUID v4 string\n\t   */\n\t  CrossStorageClient._generateUUID = function() {\n\t    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n\t      var r = Math.random() * 16|0, v = c == 'x' ? r : (r&0x3|0x8);\n\t\n\t      return v.toString(16);\n\t    });\n\t  };\n\t\n\t  /**\n\t   * Returns a promise that is fulfilled when a connection has been established\n\t   * with the cross storage hub. Its use is required to avoid sending any\n\t   * requests prior to initialization being complete.\n\t   *\n\t   * @returns {Promise} A promise that is resolved on connect\n\t   */\n\t  CrossStorageClient.prototype.onConnect = function() {\n\t    var client = this;\n\t\n\t    if (this._connected) {\n\t      return this._promise.resolve();\n\t    } else if (this._closed) {\n\t      return this._promise.reject(new Error('CrossStorageClient has closed'));\n\t    }\n\t\n\t    // Queue connect requests for client re-use\n\t    if (!this._requests.connect) {\n\t      this._requests.connect = [];\n\t    }\n\t\n\t    return new this._promise(function(resolve, reject) {\n\t      var timeout = setTimeout(function() {\n\t        reject(new Error('CrossStorageClient could not connect'));\n\t      }, client._timeout);\n\t\n\t      client._requests.connect.push(function(err) {\n\t        clearTimeout(timeout);\n\t        if (err) return reject(err);\n\t\n\t        resolve();\n\t      });\n\t    });\n\t  };\n\t\n\t  /**\n\t   * Sets a key to the specified value. Returns a promise that is fulfilled on\n\t   * success, or rejected if any errors setting the key occurred, or the request\n\t   * timed out.\n\t   *\n\t   * @param   {string}  key   The key to set\n\t   * @param   {*}       value The value to assign\n\t   * @returns {Promise} A promise that is settled on hub response or timeout\n\t   */\n\t  CrossStorageClient.prototype.set = function(key, value) {\n\t    return this._request('set', {\n\t      key:   key,\n\t      value: value\n\t    });\n\t  };\n\t\n\t  /**\n\t   * Accepts one or more keys for which to retrieve their values. Returns a\n\t   * promise that is settled on hub response or timeout. On success, it is\n\t   * fulfilled with the value of the key if only passed a single argument.\n\t   * Otherwise it's resolved with an array of values. On failure, it is rejected\n\t   * with the corresponding error message.\n\t   *\n\t   * @param   {...string} key The key to retrieve\n\t   * @returns {Promise}   A promise that is settled on hub response or timeout\n\t   */\n\t  CrossStorageClient.prototype.get = function(key) {\n\t    var args = Array.prototype.slice.call(arguments);\n\t\n\t    return this._request('get', {keys: args});\n\t  };\n\t\n\t  /**\n\t   * Accepts one or more keys for deletion. Returns a promise that is settled on\n\t   * hub response or timeout.\n\t   *\n\t   * @param   {...string} key The key to delete\n\t   * @returns {Promise}   A promise that is settled on hub response or timeout\n\t   */\n\t  CrossStorageClient.prototype.del = function() {\n\t    var args = Array.prototype.slice.call(arguments);\n\t\n\t    return this._request('del', {keys: args});\n\t  };\n\t\n\t  /**\n\t   * Returns a promise that, when resolved, indicates that all localStorage\n\t   * data has been cleared.\n\t   *\n\t   * @returns {Promise} A promise that is settled on hub response or timeout\n\t   */\n\t  CrossStorageClient.prototype.clear = function() {\n\t    return this._request('clear');\n\t  };\n\t\n\t  /**\n\t   * Returns a promise that, when resolved, passes an array of all keys\n\t   * currently in storage.\n\t   *\n\t   * @returns {Promise} A promise that is settled on hub response or timeout\n\t   */\n\t  CrossStorageClient.prototype.getKeys = function() {\n\t    return this._request('getKeys');\n\t  };\n\t\n\t  /**\n\t   * Deletes the iframe and sets the connected state to false. The client can\n\t   * no longer be used after being invoked.\n\t   */\n\t  CrossStorageClient.prototype.close = function() {\n\t    var frame = document.getElementById(this._frameId);\n\t    if (frame) {\n\t      frame.parentNode.removeChild(frame);\n\t    }\n\t\n\t    // Support IE8 with detachEvent\n\t    if (window.removeEventListener) {\n\t      window.removeEventListener('message', this._listener, false);\n\t    } else {\n\t      window.detachEvent('onmessage', this._listener);\n\t    }\n\t\n\t    this._connected = false;\n\t    this._closed = true;\n\t  };\n\t\n\t  /**\n\t   * Installs the necessary listener for the window message event. When a message\n\t   * is received, the client's _connected status is changed to true, and the\n\t   * onConnect promise is fulfilled. Given a response message, the callback\n\t   * corresponding to its request is invoked. If response.error holds a truthy\n\t   * value, the promise associated with the original request is rejected with\n\t   * the error. Otherwise the promise is fulfilled and passed response.result.\n\t   *\n\t   * @private\n\t   */\n\t  CrossStorageClient.prototype._installListener = function() {\n\t    var client = this;\n\t\n\t    this._listener = function(message) {\n\t      var i, origin, error, response;\n\t\n\t      // Ignore invalid messages or those after the client has closed\n\t      if (client._closed || !message.data || typeof message.data !== 'string') {\n\t        return;\n\t      }\n\t\n\t      // postMessage returns the string \"null\" as the origin for \"file://\"\n\t      origin = (message.origin === 'null') ? 'file://' : message.origin;\n\t\n\t      // Ignore messages not from the correct origin\n\t      if (origin !== client._origin) return;\n\t\n\t      // LocalStorage isn't available in the hub\n\t      if (message.data === 'cross-storage:unavailable') {\n\t        if (!client._closed) client.close();\n\t        if (!client._requests.connect) return;\n\t\n\t        error = new Error('Closing client. Could not access localStorage in hub.');\n\t        for (i = 0; i < client._requests.connect.length; i++) {\n\t          client._requests.connect[i](error);\n\t        }\n\t\n\t        return;\n\t      }\n\t\n\t      // Handle initial connection\n\t      if (message.data.indexOf('cross-storage:') !== -1 && !client._connected) {\n\t        client._connected = true;\n\t        if (!client._requests.connect) return;\n\t\n\t        for (i = 0; i < client._requests.connect.length; i++) {\n\t          client._requests.connect[i](error);\n\t        }\n\t        delete client._requests.connect;\n\t      }\n\t\n\t      if (message.data === 'cross-storage:ready') return;\n\t\n\t      // All other messages\n\t      try {\n\t        response = JSON.parse(message.data);\n\t      } catch(e) {\n\t        return;\n\t      }\n\t\n\t      if (!response.id) return;\n\t\n\t      if (client._requests[response.id]) {\n\t        client._requests[response.id](response.error, response.result);\n\t      }\n\t    };\n\t\n\t    // Support IE8 with attachEvent\n\t    if (window.addEventListener) {\n\t      window.addEventListener('message', this._listener, false);\n\t    } else {\n\t      window.attachEvent('onmessage', this._listener);\n\t    }\n\t  };\n\t\n\t  /**\n\t   * Invoked when a frame id was passed to the client, rather than allowing\n\t   * the client to create its own iframe. Polls the hub for a ready event to\n\t   * establish a connected state.\n\t   */\n\t  CrossStorageClient.prototype._poll = function() {\n\t    var client, interval, targetOrigin;\n\t\n\t    client = this;\n\t\n\t    // postMessage requires that the target origin be set to \"*\" for \"file://\"\n\t    targetOrigin = (client._origin === 'file://') ? '*' : client._origin;\n\t\n\t    interval = setInterval(function() {\n\t      if (client._connected) return clearInterval(interval);\n\t      if (!client._hub) return;\n\t\n\t      client._hub.postMessage('cross-storage:poll', targetOrigin);\n\t    }, 1000);\n\t  };\n\t\n\t  /**\n\t   * Creates a new iFrame containing the hub. Applies the necessary styles to\n\t   * hide the element from view, prior to adding it to the document body.\n\t   * Returns the created element.\n\t   *\n\t   * @private\n\t   *\n\t   * @param  {string}            url The url to the hub\n\t   * returns {HTMLIFrameElement} The iFrame element itself\n\t   */\n\t  CrossStorageClient.prototype._createFrame = function(url) {\n\t    var frame, key;\n\t\n\t    frame = window.document.createElement('iframe');\n\t    frame.id = this._frameId;\n\t\n\t    // Style the iframe\n\t    for (key in CrossStorageClient.frameStyle) {\n\t      if (CrossStorageClient.frameStyle.hasOwnProperty(key)) {\n\t        frame.style[key] = CrossStorageClient.frameStyle[key];\n\t      }\n\t    }\n\t\n\t    window.document.body.appendChild(frame);\n\t    frame.src = url;\n\t\n\t    return frame;\n\t  };\n\t\n\t  /**\n\t   * Sends a message containing the given method and params to the hub. Stores\n\t   * a callback in the _requests object for later invocation on message, or\n\t   * deletion on timeout. Returns a promise that is settled in either instance.\n\t   *\n\t   * @private\n\t   *\n\t   * @param   {string}  method The method to invoke\n\t   * @param   {*}       params The arguments to pass\n\t   * @returns {Promise} A promise that is settled on hub response or timeout\n\t   */\n\t  CrossStorageClient.prototype._request = function(method, params) {\n\t    var req, client;\n\t\n\t    if (this._closed) {\n\t      return this._promise.reject(new Error('CrossStorageClient has closed'));\n\t    }\n\t\n\t    client = this;\n\t    client._count++;\n\t\n\t    req = {\n\t      id:     this._id + ':' + client._count,\n\t      method: 'cross-storage:' + method,\n\t      params: params\n\t    };\n\t\n\t    return new this._promise(function(resolve, reject) {\n\t      var timeout, originalToJSON, targetOrigin;\n\t\n\t      // Timeout if a response isn't received after 4s\n\t      timeout = setTimeout(function() {\n\t        if (!client._requests[req.id]) return;\n\t\n\t        delete client._requests[req.id];\n\t        reject(new Error('Timeout: could not perform ' + req.method));\n\t      }, client._timeout);\n\t\n\t      // Add request callback\n\t      client._requests[req.id] = function(err, result) {\n\t        clearTimeout(timeout);\n\t        delete client._requests[req.id];\n\t        if (err) return reject(new Error(err));\n\t        resolve(result);\n\t      };\n\t\n\t      // In case we have a broken Array.prototype.toJSON, e.g. because of\n\t      // old versions of prototype\n\t      if (Array.prototype.toJSON) {\n\t        originalToJSON = Array.prototype.toJSON;\n\t        Array.prototype.toJSON = null;\n\t      }\n\t\n\t      // postMessage requires that the target origin be set to \"*\" for \"file://\"\n\t      targetOrigin = (client._origin === 'file://') ? '*' : client._origin;\n\t\n\t      // Send serialized message\n\t      client._hub.postMessage(JSON.stringify(req), targetOrigin);\n\t\n\t      // Restore original toJSON\n\t      if (originalToJSON) {\n\t        Array.prototype.toJSON = originalToJSON;\n\t      }\n\t    });\n\t  };\n\t\n\t  /**\n\t   * Export for various environments.\n\t   */\n\t  if (typeof module !== 'undefined' && module.exports) {\n\t    module.exports = CrossStorageClient;\n\t  } else if (true) {\n\t    exports.CrossStorageClient = CrossStorageClient;\n\t  } else if (typeof define === 'function' && define.amd) {\n\t    define([], function() {\n\t      return CrossStorageClient;\n\t    });\n\t  } else {\n\t    root.CrossStorageClient = CrossStorageClient;\n\t  }\n\t}(this));\n\n\n/***/ },\n\n/***/ 235:\n/***/ function(module, exports, __webpack_require__) {\n\n\t;(function(root) {\n\t  var CrossStorageHub = {};\n\t\n\t  /**\n\t   * Accepts an array of objects with two keys: origin and allow. The value\n\t   * of origin is expected to be a RegExp, and allow, an array of strings.\n\t   * The cross storage hub is then initialized to accept requests from any of\n\t   * the matching origins, allowing access to the associated lists of methods.\n\t   * Methods may include any of: get, set, del, getKeys and clear. A 'ready'\n\t   * message is sent to the parent window once complete.\n\t   *\n\t   * @example\n\t   * // Subdomain can get, but only root domain can set and del\n\t   * CrossStorageHub.init([\n\t   *   {origin: /\\.example.com$/,        allow: ['get']},\n\t   *   {origin: /:(www\\.)?example.com$/, allow: ['get', 'set', 'del']}\n\t   * ]);\n\t   *\n\t   * @param {array} permissions An array of objects with origin and allow\n\t   */\n\t  CrossStorageHub.init = function(permissions) {\n\t    var available = true;\n\t\n\t    // Return if localStorage is unavailable, or third party\n\t    // access is disabled\n\t    try {\n\t      if (!window.localStorage) available = false;\n\t    } catch (e) {\n\t      available = false;\n\t    }\n\t\n\t    if (!available) {\n\t      try {\n\t        return window.parent.postMessage('cross-storage:unavailable', '*');\n\t      } catch (e) {\n\t        return;\n\t      }\n\t    }\n\t\n\t    CrossStorageHub._permissions = permissions || [];\n\t    CrossStorageHub._installListener();\n\t    window.parent.postMessage('cross-storage:ready', '*');\n\t  };\n\t\n\t  /**\n\t   * Installs the necessary listener for the window message event. Accommodates\n\t   * IE8 and up.\n\t   *\n\t   * @private\n\t   */\n\t  CrossStorageHub._installListener = function() {\n\t    var listener = CrossStorageHub._listener;\n\t    if (window.addEventListener) {\n\t      window.addEventListener('message', listener, false);\n\t    } else {\n\t      window.attachEvent('onmessage', listener);\n\t    }\n\t  };\n\t\n\t  /**\n\t   * The message handler for all requests posted to the window. It ignores any\n\t   * messages having an origin that does not match the originally supplied\n\t   * pattern. Given a JSON object with one of get, set, del or getKeys as the\n\t   * method, the function performs the requested action and returns its result.\n\t   *\n\t   * @param {MessageEvent} message A message to be processed\n\t   */\n\t  CrossStorageHub._listener = function(message) {\n\t    var origin, targetOrigin, request, method, error, result, response;\n\t\n\t    // postMessage returns the string \"null\" as the origin for \"file://\"\n\t    origin = (message.origin === 'null') ? 'file://' : message.origin;\n\t\n\t    // Handle polling for a ready message\n\t    if (message.data === 'cross-storage:poll') {\n\t      return window.parent.postMessage('cross-storage:ready', message.origin);\n\t    }\n\t\n\t    // Ignore the ready message when viewing the hub directly\n\t    if (message.data === 'cross-storage:ready') return;\n\t\n\t    // Check whether message.data is a valid json\n\t    try {\n\t      request = JSON.parse(message.data);\n\t    } catch (err) {\n\t      return;\n\t    }\n\t\n\t    // Check whether request.method is a string\n\t    if (!request || typeof request.method !== 'string') {\n\t      return;\n\t    }\n\t\n\t    method = request.method.split('cross-storage:')[1];\n\t\n\t    if (!method) {\n\t      return;\n\t    } else if (!CrossStorageHub._permitted(origin, method)) {\n\t      error = 'Invalid permissions for ' + method;\n\t    } else {\n\t      try {\n\t        result = CrossStorageHub['_' + method](request.params);\n\t      } catch (err) {\n\t        error = err.message;\n\t      }\n\t    }\n\t\n\t    response = JSON.stringify({\n\t      id: request.id,\n\t      error: error,\n\t      result: result\n\t    });\n\t\n\t    // postMessage requires that the target origin be set to \"*\" for \"file://\"\n\t    targetOrigin = (origin === 'file://') ? '*' : origin;\n\t\n\t    window.parent.postMessage(response, targetOrigin);\n\t  };\n\t\n\t  /**\n\t   * Returns a boolean indicating whether or not the requested method is\n\t   * permitted for the given origin. The argument passed to method is expected\n\t   * to be one of 'get', 'set', 'del' or 'getKeys'.\n\t   *\n\t   * @param   {string} origin The origin for which to determine permissions\n\t   * @param   {string} method Requested action\n\t   * @returns {bool}   Whether or not the request is permitted\n\t   */\n\t  CrossStorageHub._permitted = function(origin, method) {\n\t    var available, i, entry, match;\n\t\n\t    available = ['get', 'set', 'del', 'clear', 'getKeys'];\n\t    if (!CrossStorageHub._inArray(method, available)) {\n\t      return false;\n\t    }\n\t\n\t    for (i = 0; i < CrossStorageHub._permissions.length; i++) {\n\t      entry = CrossStorageHub._permissions[i];\n\t      if (!(entry.origin instanceof RegExp) || !(entry.allow instanceof Array)) {\n\t        continue;\n\t      }\n\t\n\t      match = entry.origin.test(origin);\n\t      if (match && CrossStorageHub._inArray(method, entry.allow)) {\n\t        return true;\n\t      }\n\t    }\n\t\n\t    return false;\n\t  };\n\t\n\t  /**\n\t   * Sets a key to the specified value.\n\t   *\n\t   * @param {object} params An object with key and value\n\t   */\n\t  CrossStorageHub._set = function(params) {\n\t    window.localStorage.setItem(params.key, params.value);\n\t  };\n\t\n\t  /**\n\t   * Accepts an object with an array of keys for which to retrieve their values.\n\t   * Returns a single value if only one key was supplied, otherwise it returns\n\t   * an array. Any keys not set result in a null element in the resulting array.\n\t   *\n\t   * @param   {object} params An object with an array of keys\n\t   * @returns {*|*[]}  Either a single value, or an array\n\t   */\n\t  CrossStorageHub._get = function(params) {\n\t    var storage, result, i, value;\n\t\n\t    storage = window.localStorage;\n\t    result = [];\n\t\n\t    for (i = 0; i < params.keys.length; i++) {\n\t      try {\n\t        value = storage.getItem(params.keys[i]);\n\t      } catch (e) {\n\t        value = null;\n\t      }\n\t\n\t      result.push(value);\n\t    }\n\t\n\t    return (result.length > 1) ? result : result[0];\n\t  };\n\t\n\t  /**\n\t   * Deletes all keys specified in the array found at params.keys.\n\t   *\n\t   * @param {object} params An object with an array of keys\n\t   */\n\t  CrossStorageHub._del = function(params) {\n\t    for (var i = 0; i < params.keys.length; i++) {\n\t      window.localStorage.removeItem(params.keys[i]);\n\t    }\n\t  };\n\t\n\t  /**\n\t   * Clears localStorage.\n\t   */\n\t  CrossStorageHub._clear = function() {\n\t    window.localStorage.clear();\n\t  };\n\t\n\t  /**\n\t   * Returns an array of all keys stored in localStorage.\n\t   *\n\t   * @returns {string[]} The array of keys\n\t   */\n\t  CrossStorageHub._getKeys = function(params) {\n\t    var i, length, keys;\n\t\n\t    keys = [];\n\t    length = window.localStorage.length;\n\t\n\t    for (i = 0; i < length; i++) {\n\t      keys.push(window.localStorage.key(i));\n\t    }\n\t\n\t    return keys;\n\t  };\n\t\n\t  /**\n\t   * Returns whether or not a value is present in the array. Consists of an\n\t   * alternative to extending the array prototype for indexOf, since it's\n\t   * unavailable for IE8.\n\t   *\n\t   * @param   {*}    value The value to find\n\t   * @parma   {[]*}  array The array in which to search\n\t   * @returns {bool} Whether or not the value was found\n\t   */\n\t  CrossStorageHub._inArray = function(value, array) {\n\t    for (var i = 0; i < array.length; i++) {\n\t      if (value === array[i]) return true;\n\t    }\n\t\n\t    return false;\n\t  };\n\t\n\t  /**\n\t   * A cross-browser version of Date.now compatible with IE8 that avoids\n\t   * modifying the Date object.\n\t   *\n\t   * @return {int} The current timestamp in milliseconds\n\t   */\n\t  CrossStorageHub._now = function() {\n\t    if (typeof Date.now === 'function') {\n\t      return Date.now();\n\t    }\n\t\n\t    return new Date().getTime();\n\t  };\n\t\n\t  /**\n\t   * Export for various environments.\n\t   */\n\t  if (typeof module !== 'undefined' && module.exports) {\n\t    module.exports = CrossStorageHub;\n\t  } else if (true) {\n\t    exports.CrossStorageHub = CrossStorageHub;\n\t  } else if (typeof define === 'function' && define.amd) {\n\t    define([], function() {\n\t      return CrossStorageHub;\n\t    });\n\t  } else {\n\t    root.CrossStorageHub = CrossStorageHub;\n\t  }\n\t}(this));\n\n\n/***/ }\n\n});\n\n\n/** WEBPACK FOOTER **\n ** hub.8570cccfc468cea9ae26.js\n **/","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar cross_storage_1 = require(\"cross-storage\");\r\ncross_storage_1.CrossStorageHub.init([\r\n    {\r\n        origin: /.*/,\r\n        allow: [\"get\", \"set\"]\r\n    }\r\n]);\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/hub/hub.ts\n **/","import { CrossStorageHub } from \"cross-storage\";\r\n\r\nCrossStorageHub.init([\r\n    {\r\n        origin: /.*/,\r\n        allow: [ \"get\", \"set\" ]\r\n    }\r\n]);\n\n\n/** WEBPACK FOOTER **\n ** ./src/hub/hub.ts\n **/","module.exports = {\n  CrossStorageClient: require('./client.js'),\n  CrossStorageHub:    require('./hub.js')\n};\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/cross-storage/lib/index.js\n ** module id = 233\n ** module chunks = 1\n **/",";(function(root) {\n  /**\n   * Constructs a new cross storage client given the url to a hub. By default,\n   * an iframe is created within the document body that points to the url. It\n   * also accepts an options object, which may include a timeout, frameId, and\n   * promise. The timeout, in milliseconds, is applied to each request and\n   * defaults to 5000ms. The options object may also include a frameId,\n   * identifying an existing frame on which to install its listeners. If the\n   * promise key is supplied the constructor for a Promise, that Promise library\n   * will be used instead of the default window.Promise.\n   *\n   * @example\n   * var storage = new CrossStorageClient('https://store.example.com/hub.html');\n   *\n   * @example\n   * var storage = new CrossStorageClient('https://store.example.com/hub.html', {\n   *   timeout: 5000,\n   *   frameId: 'storageFrame'\n   * });\n   *\n   * @constructor\n   *\n   * @param {string} url    The url to a cross storage hub\n   * @param {object} [opts] An optional object containing additional options,\n   *                        including timeout, frameId, and promise\n   *\n   * @property {string}   _id        A UUID v4 id\n   * @property {function} _promise   The Promise object to use\n   * @property {string}   _frameId   The id of the iFrame pointing to the hub url\n   * @property {string}   _origin    The hub's origin\n   * @property {object}   _requests  Mapping of request ids to callbacks\n   * @property {bool}     _connected Whether or not it has connected\n   * @property {bool}     _closed    Whether or not the client has closed\n   * @property {int}      _count     Number of requests sent\n   * @property {function} _listener  The listener added to the window\n   * @property {Window}   _hub       The hub window\n   */\n  function CrossStorageClient(url, opts) {\n    opts = opts || {};\n\n    this._id        = CrossStorageClient._generateUUID();\n    this._promise   = opts.promise || Promise;\n    this._frameId   = opts.frameId || 'CrossStorageClient-' + this._id;\n    this._origin    = CrossStorageClient._getOrigin(url);\n    this._requests  = {};\n    this._connected = false;\n    this._closed    = false;\n    this._count     = 0;\n    this._timeout   = opts.timeout || 5000;\n    this._listener  = null;\n\n    this._installListener();\n\n    var frame;\n    if (opts.frameId) {\n      frame = document.getElementById(opts.frameId);\n    }\n\n    // If using a passed iframe, poll the hub for a ready message\n    if (frame) {\n      this._poll();\n    }\n\n    // Create the frame if not found or specified\n    frame = frame || this._createFrame(url);\n    this._hub = frame.contentWindow;\n  }\n\n  /**\n   * The styles to be applied to the generated iFrame. Defines a set of properties\n   * that hide the element by positioning it outside of the visible area, and\n   * by modifying its display.\n   *\n   * @member {Object}\n   */\n  CrossStorageClient.frameStyle = {\n    display:  'none',\n    position: 'absolute',\n    top:      '-999px',\n    left:     '-999px'\n  };\n\n  /**\n   * Returns the origin of an url, with cross browser support. Accommodates\n   * the lack of location.origin in IE, as well as the discrepancies in the\n   * inclusion of the port when using the default port for a protocol, e.g.\n   * 443 over https. Defaults to the origin of window.location if passed a\n   * relative path.\n   *\n   * @param   {string} url The url to a cross storage hub\n   * @returns {string} The origin of the url\n   */\n  CrossStorageClient._getOrigin = function(url) {\n    var uri, protocol, origin;\n\n    uri = document.createElement('a');\n    uri.href = url;\n\n    if (!uri.host) {\n      uri = window.location;\n    }\n\n    if (!uri.protocol || uri.protocol === ':') {\n      protocol = window.location.protocol;\n    } else {\n      protocol = uri.protocol;\n    }\n\n    origin = protocol + '//' + uri.host;\n    origin = origin.replace(/:80$|:443$/, '');\n\n    return origin;\n  };\n\n  /**\n   * UUID v4 generation, taken from: http://stackoverflow.com/questions/\n   * 105034/how-to-create-a-guid-uuid-in-javascript/2117523#2117523\n   *\n   * @returns {string} A UUID v4 string\n   */\n  CrossStorageClient._generateUUID = function() {\n    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n      var r = Math.random() * 16|0, v = c == 'x' ? r : (r&0x3|0x8);\n\n      return v.toString(16);\n    });\n  };\n\n  /**\n   * Returns a promise that is fulfilled when a connection has been established\n   * with the cross storage hub. Its use is required to avoid sending any\n   * requests prior to initialization being complete.\n   *\n   * @returns {Promise} A promise that is resolved on connect\n   */\n  CrossStorageClient.prototype.onConnect = function() {\n    var client = this;\n\n    if (this._connected) {\n      return this._promise.resolve();\n    } else if (this._closed) {\n      return this._promise.reject(new Error('CrossStorageClient has closed'));\n    }\n\n    // Queue connect requests for client re-use\n    if (!this._requests.connect) {\n      this._requests.connect = [];\n    }\n\n    return new this._promise(function(resolve, reject) {\n      var timeout = setTimeout(function() {\n        reject(new Error('CrossStorageClient could not connect'));\n      }, client._timeout);\n\n      client._requests.connect.push(function(err) {\n        clearTimeout(timeout);\n        if (err) return reject(err);\n\n        resolve();\n      });\n    });\n  };\n\n  /**\n   * Sets a key to the specified value. Returns a promise that is fulfilled on\n   * success, or rejected if any errors setting the key occurred, or the request\n   * timed out.\n   *\n   * @param   {string}  key   The key to set\n   * @param   {*}       value The value to assign\n   * @returns {Promise} A promise that is settled on hub response or timeout\n   */\n  CrossStorageClient.prototype.set = function(key, value) {\n    return this._request('set', {\n      key:   key,\n      value: value\n    });\n  };\n\n  /**\n   * Accepts one or more keys for which to retrieve their values. Returns a\n   * promise that is settled on hub response or timeout. On success, it is\n   * fulfilled with the value of the key if only passed a single argument.\n   * Otherwise it's resolved with an array of values. On failure, it is rejected\n   * with the corresponding error message.\n   *\n   * @param   {...string} key The key to retrieve\n   * @returns {Promise}   A promise that is settled on hub response or timeout\n   */\n  CrossStorageClient.prototype.get = function(key) {\n    var args = Array.prototype.slice.call(arguments);\n\n    return this._request('get', {keys: args});\n  };\n\n  /**\n   * Accepts one or more keys for deletion. Returns a promise that is settled on\n   * hub response or timeout.\n   *\n   * @param   {...string} key The key to delete\n   * @returns {Promise}   A promise that is settled on hub response or timeout\n   */\n  CrossStorageClient.prototype.del = function() {\n    var args = Array.prototype.slice.call(arguments);\n\n    return this._request('del', {keys: args});\n  };\n\n  /**\n   * Returns a promise that, when resolved, indicates that all localStorage\n   * data has been cleared.\n   *\n   * @returns {Promise} A promise that is settled on hub response or timeout\n   */\n  CrossStorageClient.prototype.clear = function() {\n    return this._request('clear');\n  };\n\n  /**\n   * Returns a promise that, when resolved, passes an array of all keys\n   * currently in storage.\n   *\n   * @returns {Promise} A promise that is settled on hub response or timeout\n   */\n  CrossStorageClient.prototype.getKeys = function() {\n    return this._request('getKeys');\n  };\n\n  /**\n   * Deletes the iframe and sets the connected state to false. The client can\n   * no longer be used after being invoked.\n   */\n  CrossStorageClient.prototype.close = function() {\n    var frame = document.getElementById(this._frameId);\n    if (frame) {\n      frame.parentNode.removeChild(frame);\n    }\n\n    // Support IE8 with detachEvent\n    if (window.removeEventListener) {\n      window.removeEventListener('message', this._listener, false);\n    } else {\n      window.detachEvent('onmessage', this._listener);\n    }\n\n    this._connected = false;\n    this._closed = true;\n  };\n\n  /**\n   * Installs the necessary listener for the window message event. When a message\n   * is received, the client's _connected status is changed to true, and the\n   * onConnect promise is fulfilled. Given a response message, the callback\n   * corresponding to its request is invoked. If response.error holds a truthy\n   * value, the promise associated with the original request is rejected with\n   * the error. Otherwise the promise is fulfilled and passed response.result.\n   *\n   * @private\n   */\n  CrossStorageClient.prototype._installListener = function() {\n    var client = this;\n\n    this._listener = function(message) {\n      var i, origin, error, response;\n\n      // Ignore invalid messages or those after the client has closed\n      if (client._closed || !message.data || typeof message.data !== 'string') {\n        return;\n      }\n\n      // postMessage returns the string \"null\" as the origin for \"file://\"\n      origin = (message.origin === 'null') ? 'file://' : message.origin;\n\n      // Ignore messages not from the correct origin\n      if (origin !== client._origin) return;\n\n      // LocalStorage isn't available in the hub\n      if (message.data === 'cross-storage:unavailable') {\n        if (!client._closed) client.close();\n        if (!client._requests.connect) return;\n\n        error = new Error('Closing client. Could not access localStorage in hub.');\n        for (i = 0; i < client._requests.connect.length; i++) {\n          client._requests.connect[i](error);\n        }\n\n        return;\n      }\n\n      // Handle initial connection\n      if (message.data.indexOf('cross-storage:') !== -1 && !client._connected) {\n        client._connected = true;\n        if (!client._requests.connect) return;\n\n        for (i = 0; i < client._requests.connect.length; i++) {\n          client._requests.connect[i](error);\n        }\n        delete client._requests.connect;\n      }\n\n      if (message.data === 'cross-storage:ready') return;\n\n      // All other messages\n      try {\n        response = JSON.parse(message.data);\n      } catch(e) {\n        return;\n      }\n\n      if (!response.id) return;\n\n      if (client._requests[response.id]) {\n        client._requests[response.id](response.error, response.result);\n      }\n    };\n\n    // Support IE8 with attachEvent\n    if (window.addEventListener) {\n      window.addEventListener('message', this._listener, false);\n    } else {\n      window.attachEvent('onmessage', this._listener);\n    }\n  };\n\n  /**\n   * Invoked when a frame id was passed to the client, rather than allowing\n   * the client to create its own iframe. Polls the hub for a ready event to\n   * establish a connected state.\n   */\n  CrossStorageClient.prototype._poll = function() {\n    var client, interval, targetOrigin;\n\n    client = this;\n\n    // postMessage requires that the target origin be set to \"*\" for \"file://\"\n    targetOrigin = (client._origin === 'file://') ? '*' : client._origin;\n\n    interval = setInterval(function() {\n      if (client._connected) return clearInterval(interval);\n      if (!client._hub) return;\n\n      client._hub.postMessage('cross-storage:poll', targetOrigin);\n    }, 1000);\n  };\n\n  /**\n   * Creates a new iFrame containing the hub. Applies the necessary styles to\n   * hide the element from view, prior to adding it to the document body.\n   * Returns the created element.\n   *\n   * @private\n   *\n   * @param  {string}            url The url to the hub\n   * returns {HTMLIFrameElement} The iFrame element itself\n   */\n  CrossStorageClient.prototype._createFrame = function(url) {\n    var frame, key;\n\n    frame = window.document.createElement('iframe');\n    frame.id = this._frameId;\n\n    // Style the iframe\n    for (key in CrossStorageClient.frameStyle) {\n      if (CrossStorageClient.frameStyle.hasOwnProperty(key)) {\n        frame.style[key] = CrossStorageClient.frameStyle[key];\n      }\n    }\n\n    window.document.body.appendChild(frame);\n    frame.src = url;\n\n    return frame;\n  };\n\n  /**\n   * Sends a message containing the given method and params to the hub. Stores\n   * a callback in the _requests object for later invocation on message, or\n   * deletion on timeout. Returns a promise that is settled in either instance.\n   *\n   * @private\n   *\n   * @param   {string}  method The method to invoke\n   * @param   {*}       params The arguments to pass\n   * @returns {Promise} A promise that is settled on hub response or timeout\n   */\n  CrossStorageClient.prototype._request = function(method, params) {\n    var req, client;\n\n    if (this._closed) {\n      return this._promise.reject(new Error('CrossStorageClient has closed'));\n    }\n\n    client = this;\n    client._count++;\n\n    req = {\n      id:     this._id + ':' + client._count,\n      method: 'cross-storage:' + method,\n      params: params\n    };\n\n    return new this._promise(function(resolve, reject) {\n      var timeout, originalToJSON, targetOrigin;\n\n      // Timeout if a response isn't received after 4s\n      timeout = setTimeout(function() {\n        if (!client._requests[req.id]) return;\n\n        delete client._requests[req.id];\n        reject(new Error('Timeout: could not perform ' + req.method));\n      }, client._timeout);\n\n      // Add request callback\n      client._requests[req.id] = function(err, result) {\n        clearTimeout(timeout);\n        delete client._requests[req.id];\n        if (err) return reject(new Error(err));\n        resolve(result);\n      };\n\n      // In case we have a broken Array.prototype.toJSON, e.g. because of\n      // old versions of prototype\n      if (Array.prototype.toJSON) {\n        originalToJSON = Array.prototype.toJSON;\n        Array.prototype.toJSON = null;\n      }\n\n      // postMessage requires that the target origin be set to \"*\" for \"file://\"\n      targetOrigin = (client._origin === 'file://') ? '*' : client._origin;\n\n      // Send serialized message\n      client._hub.postMessage(JSON.stringify(req), targetOrigin);\n\n      // Restore original toJSON\n      if (originalToJSON) {\n        Array.prototype.toJSON = originalToJSON;\n      }\n    });\n  };\n\n  /**\n   * Export for various environments.\n   */\n  if (typeof module !== 'undefined' && module.exports) {\n    module.exports = CrossStorageClient;\n  } else if (typeof exports !== 'undefined') {\n    exports.CrossStorageClient = CrossStorageClient;\n  } else if (typeof define === 'function' && define.amd) {\n    define([], function() {\n      return CrossStorageClient;\n    });\n  } else {\n    root.CrossStorageClient = CrossStorageClient;\n  }\n}(this));\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/cross-storage/lib/client.js\n ** module id = 234\n ** module chunks = 1\n **/",";(function(root) {\n  var CrossStorageHub = {};\n\n  /**\n   * Accepts an array of objects with two keys: origin and allow. The value\n   * of origin is expected to be a RegExp, and allow, an array of strings.\n   * The cross storage hub is then initialized to accept requests from any of\n   * the matching origins, allowing access to the associated lists of methods.\n   * Methods may include any of: get, set, del, getKeys and clear. A 'ready'\n   * message is sent to the parent window once complete.\n   *\n   * @example\n   * // Subdomain can get, but only root domain can set and del\n   * CrossStorageHub.init([\n   *   {origin: /\\.example.com$/,        allow: ['get']},\n   *   {origin: /:(www\\.)?example.com$/, allow: ['get', 'set', 'del']}\n   * ]);\n   *\n   * @param {array} permissions An array of objects with origin and allow\n   */\n  CrossStorageHub.init = function(permissions) {\n    var available = true;\n\n    // Return if localStorage is unavailable, or third party\n    // access is disabled\n    try {\n      if (!window.localStorage) available = false;\n    } catch (e) {\n      available = false;\n    }\n\n    if (!available) {\n      try {\n        return window.parent.postMessage('cross-storage:unavailable', '*');\n      } catch (e) {\n        return;\n      }\n    }\n\n    CrossStorageHub._permissions = permissions || [];\n    CrossStorageHub._installListener();\n    window.parent.postMessage('cross-storage:ready', '*');\n  };\n\n  /**\n   * Installs the necessary listener for the window message event. Accommodates\n   * IE8 and up.\n   *\n   * @private\n   */\n  CrossStorageHub._installListener = function() {\n    var listener = CrossStorageHub._listener;\n    if (window.addEventListener) {\n      window.addEventListener('message', listener, false);\n    } else {\n      window.attachEvent('onmessage', listener);\n    }\n  };\n\n  /**\n   * The message handler for all requests posted to the window. It ignores any\n   * messages having an origin that does not match the originally supplied\n   * pattern. Given a JSON object with one of get, set, del or getKeys as the\n   * method, the function performs the requested action and returns its result.\n   *\n   * @param {MessageEvent} message A message to be processed\n   */\n  CrossStorageHub._listener = function(message) {\n    var origin, targetOrigin, request, method, error, result, response;\n\n    // postMessage returns the string \"null\" as the origin for \"file://\"\n    origin = (message.origin === 'null') ? 'file://' : message.origin;\n\n    // Handle polling for a ready message\n    if (message.data === 'cross-storage:poll') {\n      return window.parent.postMessage('cross-storage:ready', message.origin);\n    }\n\n    // Ignore the ready message when viewing the hub directly\n    if (message.data === 'cross-storage:ready') return;\n\n    // Check whether message.data is a valid json\n    try {\n      request = JSON.parse(message.data);\n    } catch (err) {\n      return;\n    }\n\n    // Check whether request.method is a string\n    if (!request || typeof request.method !== 'string') {\n      return;\n    }\n\n    method = request.method.split('cross-storage:')[1];\n\n    if (!method) {\n      return;\n    } else if (!CrossStorageHub._permitted(origin, method)) {\n      error = 'Invalid permissions for ' + method;\n    } else {\n      try {\n        result = CrossStorageHub['_' + method](request.params);\n      } catch (err) {\n        error = err.message;\n      }\n    }\n\n    response = JSON.stringify({\n      id: request.id,\n      error: error,\n      result: result\n    });\n\n    // postMessage requires that the target origin be set to \"*\" for \"file://\"\n    targetOrigin = (origin === 'file://') ? '*' : origin;\n\n    window.parent.postMessage(response, targetOrigin);\n  };\n\n  /**\n   * Returns a boolean indicating whether or not the requested method is\n   * permitted for the given origin. The argument passed to method is expected\n   * to be one of 'get', 'set', 'del' or 'getKeys'.\n   *\n   * @param   {string} origin The origin for which to determine permissions\n   * @param   {string} method Requested action\n   * @returns {bool}   Whether or not the request is permitted\n   */\n  CrossStorageHub._permitted = function(origin, method) {\n    var available, i, entry, match;\n\n    available = ['get', 'set', 'del', 'clear', 'getKeys'];\n    if (!CrossStorageHub._inArray(method, available)) {\n      return false;\n    }\n\n    for (i = 0; i < CrossStorageHub._permissions.length; i++) {\n      entry = CrossStorageHub._permissions[i];\n      if (!(entry.origin instanceof RegExp) || !(entry.allow instanceof Array)) {\n        continue;\n      }\n\n      match = entry.origin.test(origin);\n      if (match && CrossStorageHub._inArray(method, entry.allow)) {\n        return true;\n      }\n    }\n\n    return false;\n  };\n\n  /**\n   * Sets a key to the specified value.\n   *\n   * @param {object} params An object with key and value\n   */\n  CrossStorageHub._set = function(params) {\n    window.localStorage.setItem(params.key, params.value);\n  };\n\n  /**\n   * Accepts an object with an array of keys for which to retrieve their values.\n   * Returns a single value if only one key was supplied, otherwise it returns\n   * an array. Any keys not set result in a null element in the resulting array.\n   *\n   * @param   {object} params An object with an array of keys\n   * @returns {*|*[]}  Either a single value, or an array\n   */\n  CrossStorageHub._get = function(params) {\n    var storage, result, i, value;\n\n    storage = window.localStorage;\n    result = [];\n\n    for (i = 0; i < params.keys.length; i++) {\n      try {\n        value = storage.getItem(params.keys[i]);\n      } catch (e) {\n        value = null;\n      }\n\n      result.push(value);\n    }\n\n    return (result.length > 1) ? result : result[0];\n  };\n\n  /**\n   * Deletes all keys specified in the array found at params.keys.\n   *\n   * @param {object} params An object with an array of keys\n   */\n  CrossStorageHub._del = function(params) {\n    for (var i = 0; i < params.keys.length; i++) {\n      window.localStorage.removeItem(params.keys[i]);\n    }\n  };\n\n  /**\n   * Clears localStorage.\n   */\n  CrossStorageHub._clear = function() {\n    window.localStorage.clear();\n  };\n\n  /**\n   * Returns an array of all keys stored in localStorage.\n   *\n   * @returns {string[]} The array of keys\n   */\n  CrossStorageHub._getKeys = function(params) {\n    var i, length, keys;\n\n    keys = [];\n    length = window.localStorage.length;\n\n    for (i = 0; i < length; i++) {\n      keys.push(window.localStorage.key(i));\n    }\n\n    return keys;\n  };\n\n  /**\n   * Returns whether or not a value is present in the array. Consists of an\n   * alternative to extending the array prototype for indexOf, since it's\n   * unavailable for IE8.\n   *\n   * @param   {*}    value The value to find\n   * @parma   {[]*}  array The array in which to search\n   * @returns {bool} Whether or not the value was found\n   */\n  CrossStorageHub._inArray = function(value, array) {\n    for (var i = 0; i < array.length; i++) {\n      if (value === array[i]) return true;\n    }\n\n    return false;\n  };\n\n  /**\n   * A cross-browser version of Date.now compatible with IE8 that avoids\n   * modifying the Date object.\n   *\n   * @return {int} The current timestamp in milliseconds\n   */\n  CrossStorageHub._now = function() {\n    if (typeof Date.now === 'function') {\n      return Date.now();\n    }\n\n    return new Date().getTime();\n  };\n\n  /**\n   * Export for various environments.\n   */\n  if (typeof module !== 'undefined' && module.exports) {\n    module.exports = CrossStorageHub;\n  } else if (typeof exports !== 'undefined') {\n    exports.CrossStorageHub = CrossStorageHub;\n  } else if (typeof define === 'function' && define.amd) {\n    define([], function() {\n      return CrossStorageHub;\n    });\n  } else {\n    root.CrossStorageHub = CrossStorageHub;\n  }\n}(this));\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/cross-storage/lib/hub.js\n ** module id = 235\n ** module chunks = 1\n **/"],"sourceRoot":""}